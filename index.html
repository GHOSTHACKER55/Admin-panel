<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fajar Collection | Mini Store</title>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<!-- EmailJS -->
<script src="https://cdn.emailjs.com/dist/email.min.js"></script>
<script>
  emailjs.init("yrbkNbRZ0_wqsChsV"); // Your public key
</script>

<style>
body{margin:0;font-family:Arial,sans-serif;background:#fff;color:#333}
header{text-align:center;padding:15px;box-shadow:0 2px 8px rgba(0,0,0,.1)}
header h1{margin:0;font-size:28px;background:linear-gradient(90deg,#ff6a00,#ffb347);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
header small{display:block;font-size:12px;color:#666;margin-top:4px}

/* Search bar */
#searchBar{width:90%;margin:10px auto;display:block;padding:10px;border-radius:8px;border:1px solid #ddd;box-shadow:0 2px 6px rgba(0,0,0,.05)}

/* Products */
.section-title{margin:15px;font-size:20px;border-bottom:2px solid #ff6a00;padding-bottom:5px}
.items{display:flex;flex-wrap:wrap;gap:15px;padding:15px}
.item{flex:0 0 calc(50% - 15px);background:#fff;border-radius:12px;box-shadow:0 4px 15px rgba(0,0,0,.08);overflow:hidden;cursor:pointer}
.item img{width:100%;height:180px;object-fit:cover}
.item-details{padding:10px}
.item-details b{display:block;font-size:16px;margin-bottom:6px}
.item-details .price{color:#ff6a00;font-weight:bold;margin-bottom:6px}
.item-details button{width:100%;padding:8px;border:none;border-radius:6px;background:#ff6a00;color:#fff;cursor:pointer}

/* Messages button */
.messages-btn{position:fixed;bottom:15px;left:50%;transform:translateX(-50%);padding:12px 25px;background:#ff6a00;color:#fff;border:none;border-radius:25px;cursor:pointer;font-weight:bold;box-shadow:0 4px 12px rgba(0,0,0,.1)}

/* Admin button */
.admin-btn{position:fixed;top:15px;right:15px;width:45px;height:45px;border-radius:50%;background:#ff6a00;color:#fff;border:none;font-size:22px;cursor:pointer}

/* Modal */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;z-index:1000}
.modal-box{background:#fff;width:400px;padding:20px;border-radius:12px;max-height:90%;overflow-y:auto}
.modal-box input,.modal-box textarea,.modal-box select{width:100%;padding:10px;margin-top:8px;border-radius:8px;border:1px solid #ddd}
.modal-box button{width:100%;margin-top:10px;background:#ff6a00;color:#fff;border:none;padding:10px;cursor:pointer}

/* Product details modal */
.item-modal .modal-box img{width:100%;margin-bottom:10px}
.item-modal .modal-box video{width:100%;margin-bottom:10px}

/* Messages list */
.messages{padding:15px}
.message{background:#fff3e6;border-left:5px solid #ff6a00;padding:10px;border-radius:8px;margin-bottom:10px}
</style>
</head>
<body>

<header>
  <h1>Fajar Collection</h1>
  <small>Mini Store by Fajar Collection</small>
</header>

<input type="text" id="searchBar" placeholder="Search products..." onkeyup="searchProducts()">

<button class="admin-btn" onclick="promptAdmin()">+</button>

<div class="section-title">Products</div>
<div class="items" id="products"></div>

<!-- Messages button -->
<button class="messages-btn" onclick="openMessages()">Messages</button>

<!-- Admin Modal -->
<div class="modal" id="adminModal">
  <div class="modal-box">
    <h3>Add Product</h3>
    <input id="iname" placeholder="Name">
    <input id="iprice" placeholder="Price">
    <textarea id="idesc" placeholder="Description"></textarea>
    <div id="imagesContainer">
      <input class="imgInput" placeholder="Image or Video URL">
    </div>
    <button onclick="addImageField()">Add More Image/Video</button>
    <button onclick="addItem()">Add Product</button>
    <hr>
    <h3>Send Message to Users</h3>
    <textarea id="amsg" placeholder="Write a message for all users"></textarea>
    <button onclick="sendMessage()">Send Message</button>
    <button style="margin-top:5px;background:#888" onclick="closeAdmin()">Close</button>
  </div>
</div>

<!-- Messages Modal -->
<div class="modal" id="messagesModal">
  <div class="modal-box">
    <h3>Messages</h3>
    <div class="messages" id="messages"></div>
    <button style="margin-top:10px;background:#888" onclick="closeMessages()">Close</button>
  </div>
</div>

<!-- Item details modal -->
<div class="modal item-modal" id="itemModal">
  <div class="modal-box" id="itemContent">
    <button style="background:#888;margin-bottom:10px;" onclick="closeItemModal()">Close</button>
  </div>
</div>

<script>
// ðŸ”¥ FIREBASE CONFIG
const firebaseConfig = {
  apiKey: "AIzaSyC41Y6mNNBFvjNeHdOOWGsjczMjyaqoqjU",
  authDomain: "fajar-collection-8aba3.firebaseapp.com",
  projectId: "fajar-collection-8aba3",
  storageBucket: "fajar-collection-8aba3.firebasestorage.app",
  messagingSenderId: "620336064195",
  appId: "1:620336064195:web:4608ae5f133de8fa17a476"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// Admin password
const adminPassword = "11222211";

// Load products
function loadProducts(){
  db.collection("products").onSnapshot(snapshot=>{
    const container = document.getElementById("products");
    container.innerHTML = "";
    snapshot.forEach(doc=>{
      const data = doc.data();
      const div = document.createElement("div");
      div.className="item";
      div.innerHTML = `<img src="${data.images[0]}">
      <div class="item-details">
        <b>${data.name}</b>
        <div class="price">${data.price? "Rs " + data.price : ""}</div>
        <button onclick="showBuyForm('${data.name}')">Buy Now</button>
      </div>`;
      div.onclick=()=>showItemDetails(data);
      container.appendChild(div);
    });
  });
}

// Search products
function searchProducts(){
  const query=document.getElementById("searchBar").value.toLowerCase();
  const items=document.querySelectorAll("#products .item");
  items.forEach(item=>{
    const name=item.querySelector("b").innerText.toLowerCase();
    item.style.display = name.includes(query) ? "block" : "none";
  });
}

// Admin
function promptAdmin(){
  const pass=prompt("Enter admin password:");
  if(pass===adminPassword) openAdmin();
  else alert("Incorrect password");
}
function openAdmin(){document.getElementById("adminModal").style.display="flex"}
function closeAdmin(){document.getElementById("adminModal").style.display="none"}
function addImageField(){
  const container=document.getElementById("imagesContainer");
  const input=document.createElement("input");
  input.className="imgInput";
  input.placeholder="Image or Video URL";
  container.appendChild(input);
}
function addItem(){
  const name=document.getElementById("iname").value;
  const price=document.getElementById("iprice").value;
  const desc=document.getElementById("idesc").value;
  const images = Array.from(document.getElementsByClassName("imgInput")).map(i=>i.value).filter(i=>i);
  if(!name || images.length==0) return alert("Name and at least 1 image required");
  db.collection("products").add({name, price, desc, images});
  document.getElementById("iname").value="";
  document.getElementById("iprice").value="";
  document.getElementById("idesc").value="";
  document.getElementById("imagesContainer").innerHTML='<input class="imgInput" placeholder="Image or Video URL">';
  closeAdmin();
}

// Admin send message
function sendMessage(){
  const text=document.getElementById("amsg").value;
  if(!text) return alert("Message cannot be empty");
  db.collection("messages").add({text});
  document.getElementById("amsg").value="";
  alert("Message sent to all users!");
  closeAdmin();
}

// Messages
function openMessages(){document.getElementById("messagesModal").style.display="flex"; loadMessages();}
function closeMessages(){document.getElementById("messagesModal").style.display="none";}
function loadMessages(){
  db.collection("messages").onSnapshot(snapshot=>{
    const container=document.getElementById("messages");
    container.innerHTML="";
    snapshot.forEach(doc=>{
      const data=doc.data();
      container.innerHTML+=`<div class="message">${data.text}</div>`;
    });
  });
}

// Item details modal
function showItemDetails(data){
  const content=document.getElementById("itemContent");
  let html=`<button style="background:#888;margin-bottom:10px;" onclick="closeItemModal()">Close</button>
  <h3>${data.name}</h3>
  <div class="price">${data.price? "Rs "+data.price : ""}</div>
  <p>${data.desc || ""}</p>`;
  data.images.forEach(url=>{
    if(url.endsWith(".mp4")) html+=`<video controls src="${url}"></video>`;
    else html+=`<img src="${url}">`;
  });
  content.innerHTML=html;
  document.getElementById("itemModal").style.display="flex";
}
function closeItemModal(){document.getElementById("itemModal").style.display="none"}

// Buy Now form modal
function showBuyForm(productName){
  const content=document.getElementById("itemContent");
  content.innerHTML=`
    <button style="background:#888;margin-bottom:10px;" onclick="closeItemModal()">Close</button>
    <h3>Buy Now: ${productName}</h3>
    <input id="order_name" placeholder="Your Name">
    <input id="order_number" placeholder="Phone Number">
    <input id="order_email" placeholder="Email">
    <input id="order_address" placeholder="Address">
    <button onclick="sendOrder('${productName}')">Submit Order</button>
  `;
  document.getElementById("itemModal").style.display="flex";
}

// Send order via EmailJS
function sendOrder(productName){
  const name = document.getElementById("order_name").value;
  const email = document.getElementById("order_email").value;
  const number = document.getElementById("order_number").value;
  const address = document.getElementById("order_address").value;
  if(!name || !email || !number || !address) return alert("All fields required");

  emailjs.send("service_pq2g8b6","template_is8ljfl",{
    user_name: name,
    user_email: email,
    user_number: number,
    product_name: productName,
    user_address: address
  }).then(()=>{
    alert("Congratulations! Your order has been sent!");
    document.getElementById("order_name").value="";
    document.getElementById("order_number").value="";
    document.getElementById("order_email").value="";
    document.getElementById("order_address").value="";
    closeItemModal();
  }, (err)=>{
    alert("Failed to send order, try again");
  });
}

// Initial load
loadProducts();
</script>

</body>
</html>