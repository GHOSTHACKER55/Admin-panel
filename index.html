<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Anonymous Shadows Admin Panel</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
body { font-family: 'Poppins', sans-serif; background:#0d1117; color:#c9d1d9; margin:0; padding:0; }
h1 { text-align:center; color:#ff7b72; margin:20px 0; }
.container { width:95%; max-width:600px; margin:0 auto; padding:10px; }
button { background:#238636; color:white; padding:10px; border:none; width:100%; border-radius:5px; cursor:pointer; font-size:16px; margin:5px 0; }
button:hover { background:#2ea043; }
table { width:100%; border-collapse: collapse; margin-top:10px; }
th, td { border:1px solid #30363d; padding:8px; text-align:left; }
th { background:#21262d; color:#58a6ff; }
td { background:#161b22; color:#c9d1d9; }
textarea { width:100%; padding:10px; border-radius:5px; border:none; margin:5px 0; font-size:14px; }
</style>
</head>
<body>
<h1>Anonymous Shadows Admin Panel</h1>
<div class="container">

    <h2>Send Notification</h2>
    <textarea id="notificationTitle" placeholder="Notification Title"></textarea>
    <textarea id="notificationBody" placeholder="Notification Body"></textarea>
    <button id="sendNotification">Send Notification</button>

    <h2>Daily Active Users</h2>
    <table>
        <thead>
            <tr><th>Timestamp</th><th>User Agent</th></tr>
        </thead>
        <tbody id="usersTable"></tbody>
    </table>

    <h2>Typing Sessions</h2>
    <table>
        <thead>
            <tr><th>Timestamp</th><th>Sentence</th><th>Typed</th><th>Speed %</th></tr>
        </thead>
        <tbody id="sessionsTable"></tbody>
    </table>

</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.6.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.6.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.6.0/firebase-messaging-compat.js"></script>

<script>
// Firebase config
const firebaseConfig = {
    apiKey: "AIzaSyCtjMyazrVnGFRASQOGjqeR_U9novXC15k",
    authDomain: "anonymous-shadows.firebaseapp.com",
    projectId: "anonymous-shadows",
    storageBucket: "anonymous-shadows.appspot.com",
    messagingSenderId: "939891243370",
    appId: "1:939891243370:web:8db01f36d0afa9a58b8d13",
    vapidKey: "BPRhIQxTwlYR0K3pZD8QomSlZFBbZz4txXmbH-i0Q5oWaf54VTVjyZ4TqsfpBgac2IMOpeOY59DMb6lsoiMewSU"
};

const app = firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const messaging = firebase.messaging();

// Load users
function loadUsers() {
    const tbody = document.getElementById("usersTable");
    tbody.innerHTML = "";
    db.collection("userVisits").orderBy("timestamp", "desc").limit(50).get().then(snapshot => {
        snapshot.forEach(doc => {
            const data = doc.data();
            const tr = document.createElement("tr");
            const time = data.timestamp ? data.timestamp.toDate().toLocaleString() : "N/A";
            tr.innerHTML = `<td>${time}</td><td>${data.userAgent}</td>`;
            tbody.appendChild(tr);
        });
    });
}

// Load typing sessions
function loadSessions() {
    const tbody = document.getElementById("sessionsTable");
    tbody.innerHTML = "";
    db.collection("typingSessions").orderBy("timestamp", "desc").limit(50).get().then(snapshot => {
        snapshot.forEach(doc => {
            const data = doc.data();
            const tr = document.createElement("tr");
            const time = data.timestamp ? data.timestamp.toDate().toLocaleString() : "N/A";
            tr.innerHTML = `<td>${time}</td><td>${data.sentence}</td><td>${data.typed}</td><td>${data.wpm}</td>`;
            tbody.appendChild(tr);
        });
    });
}

// Send notification to all tokens
document.getElementById("sendNotification").addEventListener("click", async () => {
    const title = document.getElementById("notificationTitle").value;
    const body = document.getElementById("notificationBody").value;
    if(!title || !body) return alert("Please fill title and body!");

    const tokensSnapshot = await db.collection("notificationTokens").get();
    const tokens = tokensSnapshot.docs.map(doc => doc.data().token);

    // Send notifications via FCM
    // You need a server endpoint (Cloud Function) to send actual FCM notifications.
    alert(`Ready to send notification to ${tokens.length} devices:\nTitle: ${title}\nBody: ${body}`);
});

// Initial load
loadUsers();
loadSessions();
</script>
</body>
</html>